# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ "–ö—Ä—É–∂–æ–∫ –°—Ç–∞–Ω–∫–µ–≤–∏—á–∞"

> –ü–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Telegram Mini App –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –æ–ª–∏–º–ø–∏–∞–¥–∞–º –ø–æ –∏—Å—Ç–æ—Ä–∏–∏

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ](#—ç—Ç–∞–ø-1-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–∏-–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
2. [–≠—Ç–∞–ø 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Backend](#—ç—Ç–∞–ø-2-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-backend)
3. [–≠—Ç–∞–ø 3: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#—ç—Ç–∞–ø-3-–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
4. [–≠—Ç–∞–ø 4: API —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#—ç—Ç–∞–ø-4-api-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
5. [–≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Frontend —Å Backend](#—ç—Ç–∞–ø-5-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-frontend-—Å-backend)
6. [–≠—Ç–∞–ø 6: Telegram Bot –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è](#—ç—Ç–∞–ø-6-telegram-bot-–∏-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)
7. [–≠—Ç–∞–ø 7: –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏](#—ç—Ç–∞–ø-7-—Ä–∞–±–æ—Ç–∞-—Å-—Ñ–∞–π–ª–∞–º–∏)
8. [–≠—Ç–∞–ø 8: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è](#—ç—Ç–∞–ø-8-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
9. [–≠—Ç–∞–ø 9: –î–µ–ø–ª–æ–π –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞](#—ç—Ç–∞–ø-9-–¥–µ–ø–ª–æ–π-–∏-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
10. [–≠—Ç–∞–ø 10: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—ç—Ç–∞–ø-10-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
11. [–≠—Ç–∞–ø 11: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ](#—ç—Ç–∞–ø-11-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è-–∏-–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1.1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
- ‚úÖ –î–≤–∞ —Ç–∏–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: —Å—Ç—É–¥–µ–Ω—Ç –∏ –∫—É—Ä–∞—Ç–æ—Ä
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–∫–∞–º–∏ (CRUD –¥–ª—è –∫—É—Ä–∞—Ç–æ—Ä–∞)
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–º–∞—à–Ω–∏–º–∏ –∑–∞–¥–∞–Ω–∏—è–º–∏
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–æ–∫ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ç—á—ë—Ç—ã
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–µ–¥–ª–∞–π–Ω–∞—Ö –∏ –Ω–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏—è—Ö

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- ‚úÖ –°–≤–µ—Ç–ª–∞—è –∏ —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (< 3 —Å–µ–∫)
- ‚úÖ –†–∞–±–æ—Ç–∞ —Å Telegram Mini App API
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### 1.2. –í—ã–±–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

**Frontend:** (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- React 19 + TypeScript
- Vite –¥–ª—è —Å–±–æ—Ä–∫–∏
- Tailwind CSS
- React Router –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- @twa-dev/sdk –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram

**Backend:** (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)
- Node.js + Express (–∏–ª–∏ Fastify –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
- TypeScript –¥–ª—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- PostgreSQL –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- Prisma ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- Redis –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- AWS S3 (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥) –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤

**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- Docker –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏
- GitHub Actions –¥–ª—è CI/CD
- Nginx –¥–ª—è reverse proxy
- SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (Let's Encrypt)

### 1.3. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```
–¢–∞–±–ª–∏—Ü—ã:
- users (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
- lessons (—É—Ä–æ–∫–∏)
- homework_tasks (–∑–∞–¥–∞–Ω–∏—è)
- submissions (—Å–¥–∞—á–∏ —Ä–∞–±–æ—Ç)
- files (—Ñ–∞–π–ª—ã)
- notifications (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
- statistics (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
```

---

## –≠—Ç–∞–ø 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Backend

### 2.1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –¥–ª—è backend
mkdir backend
cd backend

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Node.js –ø—Ä–æ–µ–∫—Ç
npm init -y

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install express typescript @types/express @types/node
npm install prisma @prisma/client
npm install dotenv cors helmet compression
npm install jsonwebtoken bcrypt
npm install multer # –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
npm install node-telegram-bot-api
npm install date-fns
npm install zod # –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

# Dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install -D nodemon ts-node tsx @types/multer
npm install -D @types/jsonwebtoken @types/bcrypt
npm install -D @types/node-telegram-bot-api
```

### 2.2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ backend

```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telegram.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ aws.ts
‚îÇ   ‚îú‚îÄ‚îÄ controllers/      # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lessons.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ homework.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ submissions.controller.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ users.controller.ts
‚îÇ   ‚îú‚îÄ‚îÄ services/         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lessons.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ homework.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ submissions.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ files.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notifications.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ statistics.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ middleware/       # Middleware
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.middleware.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ role.middleware.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validation.middleware.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ error.middleware.ts
‚îÇ   ‚îú‚îÄ‚îÄ routes/          # –ú–∞—Ä—à—Ä—É—Ç—ã API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.routes.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lessons.routes.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ homework.routes.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ submissions.routes.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ files.routes.ts
‚îÇ   ‚îú‚îÄ‚îÄ types/           # TypeScript —Ç–∏–ø—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ utils/           # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validators.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ helpers.ts
‚îÇ   ‚îú‚îÄ‚îÄ prisma/          # Prisma schema
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma
‚îÇ   ‚îî‚îÄ‚îÄ app.ts           # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ package.json
```

### 2.3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TypeScript

**tsconfig.json:**
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "commonjs",
    "lib": ["ES2022"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "moduleResolution": "node"
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules"]
}
```

### 2.4. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**.env.example:**
```env
# Server
NODE_ENV=development
PORT=3000
API_URL=http://localhost:3000

# Database
DATABASE_URL=postgresql://user:password@localhost:5432/kruzhok_db

# JWT
JWT_SECRET=your-super-secret-key-change-in-production
JWT_EXPIRES_IN=7d

# Telegram
TELEGRAM_BOT_TOKEN=your-bot-token-from-botfather
TELEGRAM_BOT_USERNAME=your_bot_username

# AWS S3 (–∏–ª–∏ –¥—Ä—É–≥–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
AWS_ACCESS_KEY_ID=your-access-key
AWS_SECRET_ACCESS_KEY=your-secret-key
AWS_REGION=us-east-1
AWS_BUCKET_NAME=kruzhok-files

# Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è)
REDIS_URL=redis://localhost:6379

# Frontend URL (–¥–ª—è CORS)
FRONTEND_URL=http://localhost:5173
```

---

## –≠—Ç–∞–ø 3: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### 3.1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL

**–õ–æ–∫–∞–ª—å–Ω–æ (macOS):**
```bash
brew install postgresql@15
brew services start postgresql@15
createdb kruzhok_db
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ Docker:**
```bash
docker run --name kruzhok-postgres \
  -e POSTGRES_PASSWORD=password \
  -e POSTGRES_DB=kruzhok_db \
  -p 5432:5432 -d postgres:15
```

### 3.2. Prisma Schema

**prisma/schema.prisma:**
```prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
model User {
  id            String   @id @default(uuid())
  telegramId    BigInt   @unique
  username      String?
  firstName     String?
  lastName      String?
  email         String?  @unique
  role          Role     @default(STUDENT)
  photoUrl      String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  submissions   Submission[]
  notifications Notification[]
  progress      Progress?
  
  @@index([telegramId])
  @@index([role])
}

enum Role {
  STUDENT
  CURATOR
  ADMIN
}

// –£—Ä–æ–∫–∏
model Lesson {
  id          String   @id @default(uuid())
  title       String
  description String
  date        DateTime
  time        String
  zoomLink    String?
  materials   String?  // JSON —Å—Ç—Ä–æ–∫–∞ —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
  status      LessonStatus @default(UPCOMING)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  homework    HomeworkTask[]
  
  @@index([date])
  @@index([status])
}

enum LessonStatus {
  UPCOMING
  TODAY
  COMPLETED
  CANCELLED
}

// –î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
model HomeworkTask {
  id          String   @id @default(uuid())
  title       String
  description String
  deadline    DateTime
  maxScore    Int      @default(100)
  fileUrl     String?  // –°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª —Å –∑–∞–¥–∞–Ω–∏–µ–º
  
  lessonId    String
  lesson      Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  submissions Submission[]
  
  @@index([lessonId])
  @@index([deadline])
}

// –°–¥–∞—á–∏ —Ä–∞–±–æ—Ç
model Submission {
  id            String   @id @default(uuid())
  
  studentId     String
  student       User     @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  homeworkId    String
  homework      HomeworkTask @relation(fields: [homeworkId], references: [id], onDelete: Cascade)
  
  fileUrl       String
  status        SubmissionStatus @default(PENDING)
  grade         Int?
  comment       String?
  
  submittedAt   DateTime @default(now())
  reviewedAt    DateTime?
  
  @@unique([studentId, homeworkId])
  @@index([studentId])
  @@index([homeworkId])
  @@index([status])
}

enum SubmissionStatus {
  NOT_SUBMITTED
  PENDING
  REVIEWED
}

// –ü—Ä–æ–≥—Ä–µ—Å—Å —Å—Ç—É–¥–µ–Ω—Ç–∞
model Progress {
  id                    String   @id @default(uuid())
  
  userId                String   @unique
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  attendance            Float    @default(0)
  homeworkCompletion    Float    @default(0)
  averageGrade          Float    @default(0)
  
  lessonsAttended       Int      @default(0)
  lessonsTotal          Int      @default(0)
  homeworksCompleted    Int      @default(0)
  homeworksTotal        Int      @default(0)
  
  updatedAt             DateTime @updatedAt
}

// –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
model Notification {
  id        String   @id @default(uuid())
  
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type      NotificationType
  title     String
  message   String
  link      String?
  read      Boolean  @default(false)
  
  createdAt DateTime @default(now())
  
  @@index([userId])
  @@index([read])
  @@index([createdAt])
}

enum NotificationType {
  NEW_LESSON
  NEW_HOMEWORK
  DEADLINE_SOON
  HOMEWORK_REVIEWED
  ANNOUNCEMENT
}

// –§–∞–π–ª—ã
model File {
  id        String   @id @default(uuid())
  filename  String
  originalName String
  mimetype  String
  size      Int
  url       String
  uploadedBy String
  createdAt DateTime @default(now())
  
  @@index([uploadedBy])
}
```

### 3.3. –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Prisma
npx prisma init

# –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
npx prisma migrate dev --name init

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma Client
npx prisma generate

# Prisma Studio –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
npx prisma studio
```

---

## –≠—Ç–∞–ø 4: API —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### 4.1. –°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

**src/app.ts:**
```typescript
import express, { Express } from 'express';
import cors from 'cors';
import helmet from 'helmet';
import compression from 'compression';
import dotenv from 'dotenv';
import routes from './routes';
import { errorHandler } from './middleware/error.middleware';

dotenv.config();

const app: Express = express();

// Middleware
app.use(helmet());
app.use(cors({
  origin: process.env.FRONTEND_URL,
  credentials: true
}));
app.use(compression());
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Routes
app.use('/api', routes);

// Health check
app.get('/health', (req, res) => {
  res.json({ status: 'ok', timestamp: new Date().toISOString() });
});

// Error handler
app.use(errorHandler);

const PORT = process.env.PORT || 3000;

app.listen(PORT, () => {
  console.log(`üöÄ Server running on port ${PORT}`);
});

export default app;
```

### 4.2. –ú–∞—Ä—à—Ä—É—Ç—ã API

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ API:**

```
POST   /api/auth/telegram        - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
GET    /api/auth/me              - –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

GET    /api/lessons              - –°–ø–∏—Å–æ–∫ —É—Ä–æ–∫–æ–≤
POST   /api/lessons              - –°–æ–∑–¥–∞—Ç—å —É—Ä–æ–∫ (–∫—É—Ä–∞—Ç–æ—Ä)
GET    /api/lessons/:id          - –ü–æ–ª—É—á–∏—Ç—å —É—Ä–æ–∫
PUT    /api/lessons/:id          - –û–±–Ω–æ–≤–∏—Ç—å —É—Ä–æ–∫ (–∫—É—Ä–∞—Ç–æ—Ä)
DELETE /api/lessons/:id          - –£–¥–∞–ª–∏—Ç—å —É—Ä–æ–∫ (–∫—É—Ä–∞—Ç–æ—Ä)

GET    /api/homework             - –°–ø–∏—Å–æ–∫ –¥–æ–º–∞—à–µ–∫
POST   /api/homework             - –°–æ–∑–¥–∞—Ç—å –¥–æ–º–∞—à–∫—É (–∫—É—Ä–∞—Ç–æ—Ä)
GET    /api/homework/:id         - –ü–æ–ª—É—á–∏—Ç—å –¥–æ–º–∞—à–∫—É
PUT    /api/homework/:id         - –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–º–∞—à–∫—É (–∫—É—Ä–∞—Ç–æ—Ä)
DELETE /api/homework/:id         - –£–¥–∞–ª–∏—Ç—å –¥–æ–º–∞—à–∫—É (–∫—É—Ä–∞—Ç–æ—Ä)

GET    /api/submissions          - –°–ø–∏—Å–æ–∫ —Å–¥–∞—á
POST   /api/submissions          - –°–¥–∞—Ç—å —Ä–∞–±–æ—Ç—É (—Å—Ç—É–¥–µ–Ω—Ç)
GET    /api/submissions/:id      - –ü–æ–ª—É—á–∏—Ç—å —Å–¥–∞—á—É
PUT    /api/submissions/:id      - –û–±–Ω–æ–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É (–∫—É—Ä–∞—Ç–æ—Ä)

POST   /api/files/upload         - –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
GET    /api/files/:id            - –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª

GET    /api/progress/:userId     - –ü—Ä–æ–≥—Ä–µ—Å—Å —Å—Ç—É–¥–µ–Ω—Ç–∞
GET    /api/statistics           - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä—É–ø–ø—ã (–∫—É—Ä–∞—Ç–æ—Ä)

GET    /api/notifications        - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
PUT    /api/notifications/:id/read - –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
```

### 4.3. –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

**src/controllers/lessons.controller.ts:**
```typescript
import { Request, Response, NextFunction } from 'express';
import { lessonsService } from '../services/lessons.service';
import { AuthRequest } from '../types';

export const lessonsController = {
  // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —É—Ä–æ–∫–∏
  async getAll(req: Request, res: Response, next: NextFunction) {
    try {
      const lessons = await lessonsService.getAll();
      res.json({ success: true, data: lessons });
    } catch (error) {
      next(error);
    }
  },

  // –°–æ–∑–¥–∞—Ç—å —É—Ä–æ–∫ (—Ç–æ–ª—å–∫–æ –∫—É—Ä–∞—Ç–æ—Ä)
  async create(req: AuthRequest, res: Response, next: NextFunction) {
    try {
      const lesson = await lessonsService.create(req.body, req.user!.id);
      res.status(201).json({ success: true, data: lesson });
    } catch (error) {
      next(error);
    }
  },

  // –ü–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω —É—Ä–æ–∫
  async getOne(req: Request, res: Response, next: NextFunction) {
    try {
      const lesson = await lessonsService.getById(req.params.id);
      res.json({ success: true, data: lesson });
    } catch (error) {
      next(error);
    }
  },

  // –û–±–Ω–æ–≤–∏—Ç—å —É—Ä–æ–∫ (—Ç–æ–ª—å–∫–æ –∫—É—Ä–∞—Ç–æ—Ä)
  async update(req: AuthRequest, res: Response, next: NextFunction) {
    try {
      const lesson = await lessonsService.update(req.params.id, req.body);
      res.json({ success: true, data: lesson });
    } catch (error) {
      next(error);
    }
  },

  // –£–¥–∞–ª–∏—Ç—å —É—Ä–æ–∫ (—Ç–æ–ª—å–∫–æ –∫—É—Ä–∞—Ç–æ—Ä)
  async delete(req: Request, res: Response, next: NextFunction) {
    try {
      await lessonsService.delete(req.params.id);
      res.json({ success: true, message: '–£—Ä–æ–∫ —É–¥–∞–ª—ë–Ω' });
    } catch (error) {
      next(error);
    }
  }
};
```

### 4.4. –ü—Ä–∏–º–µ—Ä —Å–µ—Ä–≤–∏—Å–∞

**src/services/lessons.service.ts:**
```typescript
import { PrismaClient } from '@prisma/client';
import { CreateLessonDto, UpdateLessonDto } from '../types';

const prisma = new PrismaClient();

export const lessonsService = {
  async getAll() {
    return await prisma.lesson.findMany({
      include: {
        homework: true
      },
      orderBy: {
        date: 'asc'
      }
    });
  },

  async getById(id: string) {
    const lesson = await prisma.lesson.findUnique({
      where: { id },
      include: {
        homework: true
      }
    });

    if (!lesson) {
      throw new Error('–£—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω');
    }

    return lesson;
  },

  async create(data: CreateLessonDto, creatorId: string) {
    return await prisma.lesson.create({
      data: {
        title: data.title,
        description: data.description,
        date: new Date(data.date),
        time: data.time,
        zoomLink: data.zoomLink,
        status: 'UPCOMING'
      }
    });
  },

  async update(id: string, data: UpdateLessonDto) {
    return await prisma.lesson.update({
      where: { id },
      data: {
        ...data,
        date: data.date ? new Date(data.date) : undefined
      }
    });
  },

  async delete(id: string) {
    return await prisma.lesson.delete({
      where: { id }
    });
  }
};
```

### 4.5. Middleware –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**src/middleware/auth.middleware.ts:**
```typescript
import { Response, NextFunction } from 'express';
import jwt from 'jsonwebtoken';
import { AuthRequest } from '../types';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export const authMiddleware = async (
  req: AuthRequest,
  res: Response,
  next: NextFunction
) => {
  try {
    const token = req.headers.authorization?.replace('Bearer ', '');

    if (!token) {
      return res.status(401).json({ 
        success: false, 
        message: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è' 
      });
    }

    const decoded = jwt.verify(token, process.env.JWT_SECRET!) as any;
    
    const user = await prisma.user.findUnique({
      where: { id: decoded.userId }
    });

    if (!user) {
      return res.status(401).json({ 
        success: false, 
        message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' 
      });
    }

    req.user = user;
    next();
  } catch (error) {
    res.status(401).json({ 
      success: false, 
      message: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω' 
    });
  }
};

export const curatorOnly = (
  req: AuthRequest,
  res: Response,
  next: NextFunction
) => {
  if (req.user?.role !== 'CURATOR' && req.user?.role !== 'ADMIN') {
    return res.status(403).json({ 
      success: false, 
      message: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω' 
    });
  }
  next();
};
```

---

## –≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Frontend —Å Backend

### 5.1. –°–æ–∑–¥–∞–Ω–∏–µ API –∫–ª–∏–µ–Ω—Ç–∞

**src/api/client.ts:**
```typescript
import axios from 'axios';

const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:3000/api';

export const apiClient = axios.create({
  baseURL: API_URL,
  headers: {
    'Content-Type': 'application/json'
  }
});

// –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω –∫ –∫–∞–∂–¥–æ–º—É –∑–∞–ø—Ä–æ—Å—É
apiClient.interceptors.request.use((config) => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
apiClient.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('token');
      window.location.href = '/';
    }
    return Promise.reject(error);
  }
);
```

### 5.2. API —Ñ—É–Ω–∫—Ü–∏–∏

**src/api/lessons.ts:**
```typescript
import { apiClient } from './client';
import { Lesson, CreateLessonDto } from '../types';

export const lessonsAPI = {
  getAll: async (): Promise<Lesson[]> => {
    const { data } = await apiClient.get('/lessons');
    return data.data;
  },

  getOne: async (id: string): Promise<Lesson> => {
    const { data } = await apiClient.get(`/lessons/${id}`);
    return data.data;
  },

  create: async (lessonData: CreateLessonDto): Promise<Lesson> => {
    const { data } = await apiClient.post('/lessons', lessonData);
    return data.data;
  },

  update: async (id: string, lessonData: Partial<CreateLessonDto>): Promise<Lesson> => {
    const { data } = await apiClient.put(`/lessons/${id}`, lessonData);
    return data.data;
  },

  delete: async (id: string): Promise<void> => {
    await apiClient.delete(`/lessons/${id}`);
  }
};
```

### 5.3. React Query –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
npm install @tanstack/react-query
```

**src/hooks/useLessons.ts:**
```typescript
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { lessonsAPI } from '../api/lessons';
import { CreateLessonDto } from '../types';

export const useLessons = () => {
  return useQuery({
    queryKey: ['lessons'],
    queryFn: lessonsAPI.getAll
  });
};

export const useCreateLesson = () => {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (data: CreateLessonDto) => lessonsAPI.create(data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['lessons'] });
    }
  });
};

export const useDeleteLesson = () => {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (id: string) => lessonsAPI.delete(id),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['lessons'] });
    }
  });
};
```

### 5.4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**src/pages/student/Schedule.tsx (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π):**
```typescript
import React from 'react';
import { useLessons } from '../../hooks/useLessons';
import { LoadingSpinner } from '../../components/LoadingSpinner';
import Card from '../../components/Card';
// ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã

const Schedule: React.FC = () => {
  const { data: lessons, isLoading, error } = useLessons();

  if (isLoading) return <LoadingSpinner />;
  if (error) return <div>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–∫–æ–≤</div>;

  return (
    <div className="space-y-6">
      <h2 className="text-2xl font-bold text-primary">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h2>
      
      <div className="space-y-4">
        {lessons?.map((lesson) => (
          <Card key={lesson.id}>
            <h3 className="text-lg font-semibold text-primary">
              {lesson.title}
            </h3>
            <p className="text-sm text-secondary">{lesson.description}</p>
            {/* ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */}
          </Card>
        ))}
      </div>
    </div>
  );
};
```

---

## –≠—Ç–∞–ø 6: Telegram Bot –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### 6.1. –°–æ–∑–¥–∞–Ω–∏–µ Telegram Bot

1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
3. –£–∫–∞–∂–∏—Ç–µ –∏–º—è –±–æ—Ç–∞: `–ö—Ä—É–∂–æ–∫ –°—Ç–∞–Ω–∫–µ–≤–∏—á–∞`
4. –£–∫–∞–∂–∏—Ç–µ username: `kruzhok_stankevich_bot`
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω

### 6.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Mini App

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newapp` –≤ BotFather
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
3. –£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
4. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∫–æ–Ω–∫—É (512x512 px)
5. –£–∫–∞–∂–∏—Ç–µ URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: `https://your-domain.com`

### 6.3. Telegram Web App –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**Frontend (src/services/telegram.ts):**
```typescript
import WebApp from '@twa-dev/sdk';
import { apiClient } from '../api/client';

export const telegramAuth = {
  async authenticate() {
    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram Web App
    const initData = WebApp.initData;
    const user = WebApp.initDataUnsafe.user;

    if (!initData || !user) {
      throw new Error('Telegram data not available');
    }

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
    const { data } = await apiClient.post('/auth/telegram', {
      initData,
      user
    });

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω
    localStorage.setItem('token', data.token);
    
    return data.user;
  },

  expandApp() {
    WebApp.expand();
  },

  enableClosingConfirmation() {
    WebApp.enableClosingConfirmation();
  },

  showAlert(message: string) {
    WebApp.showAlert(message);
  }
};
```

**Backend (src/services/auth.service.ts):**
```typescript
import crypto from 'crypto';
import jwt from 'jsonwebtoken';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export const authService = {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ Telegram
  verifyTelegramAuth(initData: string): boolean {
    const BOT_TOKEN = process.env.TELEGRAM_BOT_TOKEN!;
    
    const urlParams = new URLSearchParams(initData);
    const hash = urlParams.get('hash');
    urlParams.delete('hash');
    
    const dataCheckString = Array.from(urlParams.entries())
      .sort(([a], [b]) => a.localeCompare(b))
      .map(([key, value]) => `${key}=${value}`)
      .join('\n');
    
    const secretKey = crypto
      .createHmac('sha256', 'WebAppData')
      .update(BOT_TOKEN)
      .digest();
    
    const calculatedHash = crypto
      .createHmac('sha256', secretKey)
      .update(dataCheckString)
      .digest('hex');
    
    return calculatedHash === hash;
  },

  async authenticateUser(telegramUser: any) {
    // –ù–∞—Ö–æ–¥–∏–º –∏–ª–∏ —Å–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    let user = await prisma.user.findUnique({
      where: { telegramId: BigInt(telegramUser.id) }
    });

    if (!user) {
      user = await prisma.user.create({
        data: {
          telegramId: BigInt(telegramUser.id),
          username: telegramUser.username,
          firstName: telegramUser.first_name,
          lastName: telegramUser.last_name,
          role: 'STUDENT' // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å—Ç—É–¥–µ–Ω—Ç
        }
      });
    }

    // –°–æ–∑–¥–∞—ë–º JWT —Ç–æ–∫–µ–Ω
    const token = jwt.sign(
      { userId: user.id, role: user.role },
      process.env.JWT_SECRET!,
      { expiresIn: process.env.JWT_EXPIRES_IN || '7d' }
    );

    return { user, token };
  }
};
```

### 6.4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ App.tsx

```typescript
import { useEffect, useState } from 'react';
import { telegramAuth } from './services/telegram';
import WebApp from '@twa-dev/sdk';

function App() {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    const init = async () => {
      try {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        WebApp.ready();
        telegramAuth.expandApp();

        // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
        await telegramAuth.authenticate();
        setIsAuthenticated(true);
      } catch (error) {
        console.error('Auth error:', error);
        WebApp.showAlert('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
      } finally {
        setIsLoading(false);
      }
    };

    init();
  }, []);

  if (isLoading) return <LoadingSpinner />;
  if (!isAuthenticated) return <div>–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</div>;

  return (
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
  );
}
```

---

## –≠—Ç–∞–ø 7: –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏

### 7.1. Backend - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

**src/services/files.service.ts:**
```typescript
import { S3Client, PutObjectCommand, GetObjectCommand } from '@aws-sdk/client-s3';
import { getSignedUrl } from '@aws-sdk/s3-request-presigner';
import { v4 as uuidv4 } from 'uuid';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

const s3Client = new S3Client({
  region: process.env.AWS_REGION!,
  credentials: {
    accessKeyId: process.env.AWS_ACCESS_KEY_ID!,
    secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY!
  }
});

export const filesService = {
  async upload(file: Express.Multer.File, userId: string) {
    const fileId = uuidv4();
    const key = `uploads/${userId}/${fileId}-${file.originalname}`;

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ S3
    await s3Client.send(
      new PutObjectCommand({
        Bucket: process.env.AWS_BUCKET_NAME!,
        Key: key,
        Body: file.buffer,
        ContentType: file.mimetype
      })
    );

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
    const fileRecord = await prisma.file.create({
      data: {
        id: fileId,
        filename: key,
        originalName: file.originalname,
        mimetype: file.mimetype,
        size: file.size,
        url: `https://${process.env.AWS_BUCKET_NAME}.s3.${process.env.AWS_REGION}.amazonaws.com/${key}`,
        uploadedBy: userId
      }
    });

    return fileRecord;
  },

  async getDownloadUrl(fileId: string): Promise<string> {
    const file = await prisma.file.findUnique({
      where: { id: fileId }
    });

    if (!file) {
      throw new Error('–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');
    }

    // –°–æ–∑–¥–∞—ë–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π URL (–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 1 —á–∞—Å)
    const command = new GetObjectCommand({
      Bucket: process.env.AWS_BUCKET_NAME!,
      Key: file.filename
    });

    return await getSignedUrl(s3Client, command, { expiresIn: 3600 });
  }
};
```

**src/routes/files.routes.ts:**
```typescript
import { Router } from 'router';
import multer from 'multer';
import { filesController } from '../controllers/files.controller';
import { authMiddleware } from '../middleware/auth.middleware';

const router = Router();
const upload = multer({ 
  storage: multer.memoryStorage(),
  limits: { fileSize: 10 * 1024 * 1024 } // 10MB
});

router.post(
  '/upload',
  authMiddleware,
  upload.single('file'),
  filesController.upload
);

router.get(
  '/:id',
  authMiddleware,
  filesController.getDownloadUrl
);

export default router;
```

### 7.2. Frontend - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

**src/components/FileUpload.tsx:**
```typescript
import React, { useState } from 'react';
import { Upload } from 'lucide-react';
import { apiClient } from '../api/client';

interface FileUploadProps {
  onUploadSuccess: (fileId: string) => void;
}

export const FileUpload: React.FC<FileUploadProps> = ({ onUploadSuccess }) => {
  const [uploading, setUploading] = useState(false);

  const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    setUploading(true);

    try {
      const formData = new FormData();
      formData.append('file', file);

      const { data } = await apiClient.post('/files/upload', formData, {
        headers: {
          'Content-Type': 'multipart/form-data'
        }
      });

      onUploadSuccess(data.data.id);
    } catch (error) {
      console.error('Upload error:', error);
      alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞');
    } finally {
      setUploading(false);
    }
  };

  return (
    <div>
      <input
        type="file"
        id="file-upload"
        className="hidden"
        onChange={handleFileChange}
        disabled={uploading}
      />
      <label
        htmlFor="file-upload"
        className="btn-primary flex items-center gap-2 cursor-pointer"
      >
        <Upload className="w-4 h-4" />
        {uploading ? '–ó–∞–≥—Ä—É–∑–∫–∞...' : '–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª'}
      </label>
    </div>
  );
};
```

---

## –≠—Ç–∞–ø 8: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### 8.1. Backend - –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**src/services/notifications.service.ts:**
```typescript
import { PrismaClient, NotificationType } from '@prisma/client';
import TelegramBot from 'node-telegram-bot-api';

const prisma = new PrismaClient();
const bot = new TelegramBot(process.env.TELEGRAM_BOT_TOKEN!, { polling: false });

export const notificationsService = {
  async create(userId: string, type: NotificationType, title: string, message: string, link?: string) {
    const notification = await prisma.notification.create({
      data: {
        userId,
        type,
        title,
        message,
        link
      }
    });

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram
    const user = await prisma.user.findUnique({ where: { id: userId } });
    if (user?.telegramId) {
      await this.sendTelegramNotification(
        Number(user.telegramId),
        title,
        message,
        link
      );
    }

    return notification;
  },

  async sendTelegramNotification(
    telegramId: number,
    title: string,
    message: string,
    link?: string
  ) {
    let text = `*${title}*\n\n${message}`;
    
    const options: any = {
      parse_mode: 'Markdown'
    };

    if (link) {
      options.reply_markup = {
        inline_keyboard: [[
          { text: '–û—Ç–∫—Ä—ã—Ç—å', web_app: { url: link } }
        ]]
      };
    }

    try {
      await bot.sendMessage(telegramId, text, options);
    } catch (error) {
      console.error('Telegram notification error:', error);
    }
  },

  async notifyDeadlineSoon(homeworkId: string) {
    const homework = await prisma.homeworkTask.findUnique({
      where: { id: homeworkId },
      include: {
        submissions: {
          where: {
            status: { not: 'REVIEWED' }
          },
          include: { student: true }
        }
      }
    });

    if (!homework) return;

    // –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤, –Ω–µ —Å–¥–∞–≤—à–∏—Ö —Ä–∞–±–æ—Ç—É
    for (const submission of homework.submissions) {
      if (submission.status === 'NOT_SUBMITTED') {
        await this.create(
          submission.studentId,
          'DEADLINE_SOON',
          '–°–∫–æ—Ä–æ –¥–µ–¥–ª–∞–π–Ω!',
          `–û—Å—Ç–∞–ª–æ—Å—å 2 –¥–Ω—è –¥–æ —Å–¥–∞—á–∏ "${homework.title}"`,
          `/homework/${homeworkId}`
        );
      }
    }
  },

  async notifyHomeworkReviewed(submissionId: string) {
    const submission = await prisma.submission.findUnique({
      where: { id: submissionId },
      include: {
        homework: true,
        student: true
      }
    });

    if (!submission) return;

    await this.create(
      submission.studentId,
      'HOMEWORK_REVIEWED',
      '–î–æ–º–∞—à–∫–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞',
      `–í–∞—à–∞ —Ä–∞–±–æ—Ç–∞ "${submission.homework.title}" –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞. –û—Ü–µ–Ω–∫–∞: ${submission.grade}%`,
      `/homework/${submission.homeworkId}`
    );
  }
};
```

### 8.2. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á

```bash
npm install node-cron
```

**src/services/scheduler.service.ts:**
```typescript
import cron from 'node-cron';
import { PrismaClient } from '@prisma/client';
import { notificationsService } from './notifications.service';

const prisma = new PrismaClient();

export const schedulerService = {
  start() {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 10:00
    cron.schedule('0 10 * * *', async () => {
      console.log('Checking deadlines...');
      
      const twoDaysFromNow = new Date();
      twoDaysFromNow.setDate(twoDaysFromNow.getDate() + 2);

      const upcomingHomework = await prisma.homeworkTask.findMany({
        where: {
          deadline: {
            gte: new Date(),
            lte: twoDaysFromNow
          }
        }
      });

      for (const homework of upcomingHomework) {
        await notificationsService.notifyDeadlineSoon(homework.id);
      }
    });

    console.log('Scheduler started');
  }
};
```

---

## –≠—Ç–∞–ø 9: –î–µ–ø–ª–æ–π –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### 9.1. Docker

**Dockerfile (backend):**
```dockerfile
FROM node:20-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .

RUN npx prisma generate

EXPOSE 3000

CMD ["npm", "start"]
```

**docker-compose.yml:**
```yaml
version: '3.8'

services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: kruzhok_db
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  backend:
    build: ./backend
    ports:
      - "3000:3000"
    environment:
      DATABASE_URL: postgresql://postgres:${DB_PASSWORD}@postgres:5432/kruzhok_db
      REDIS_URL: redis://redis:6379
    depends_on:
      - postgres
      - redis

  frontend:
    build: ./
    ports:
      - "80:80"
    depends_on:
      - backend

volumes:
  postgres_data:
```

### 9.2. GitHub Actions

**.github/workflows/deploy.yml:**
```yaml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build
        run: npm run build
        env:
          VITE_API_URL: ${{ secrets.API_URL }}
      
      - name: Deploy to server
        uses: easingthemes/ssh-deploy@v2
        env:
          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
          REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
          REMOTE_USER: ${{ secrets.REMOTE_USER }}
          TARGET: /var/www/kruzhok
```

### 9.3. Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**/etc/nginx/sites-available/kruzhok:**
```nginx
server {
    listen 80;
    server_name your-domain.com;

    # Frontend
    location / {
        root /var/www/kruzhok/dist;
        try_files $uri $uri/ /index.html;
    }

    # Backend API
    location /api {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### 9.4. SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot
sudo apt install certbot python3-certbot-nginx

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
sudo certbot --nginx -d your-domain.com

# –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
sudo certbot renew --dry-run
```

---

## –≠—Ç–∞–ø 10: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 10.1. Unit —Ç–µ—Å—Ç—ã (Backend)

```bash
npm install -D jest @types/jest ts-jest supertest @types/supertest
```

**backend/src/services/lessons.service.test.ts:**
```typescript
import { lessonsService } from './lessons.service';
import { prismaMock } from '../test/prisma-mock';

describe('LessonsService', () => {
  test('should create a lesson', async () => {
    const lessonData = {
      title: 'Test Lesson',
      description: 'Test Description',
      date: '2025-10-15',
      time: '18:00'
    };

    prismaMock.lesson.create.mockResolvedValue({
      id: '1',
      ...lessonData,
      date: new Date(lessonData.date),
      status: 'UPCOMING',
      createdAt: new Date(),
      updatedAt: new Date()
    });

    const lesson = await lessonsService.create(lessonData, 'user-id');

    expect(lesson.title).toBe(lessonData.title);
  });
});
```

### 10.2. E2E —Ç–µ—Å—Ç—ã (Frontend)

```bash
npm install -D @playwright/test
```

**tests/e2e/lessons.spec.ts:**
```typescript
import { test, expect } from '@playwright/test';

test.describe('Lessons', () => {
  test('should display lessons list', async ({ page }) => {
    await page.goto('/schedule');
    
    await expect(page.getByText('–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ')).toBeVisible();
    await expect(page.getByText('–î—Ä–µ–≤–Ω—è—è –†—É—Å—å')).toBeVisible();
  });

  test('curator should be able to create lesson', async ({ page }) => {
    await page.goto('/curator/lessons');
    
    await page.click('text=–î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫');
    await page.fill('input[name="title"]', '–ù–æ–≤—ã–π —É—Ä–æ–∫');
    await page.fill('textarea[name="description"]', '–û–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–∞');
    await page.click('button[type="submit"]');
    
    await expect(page.getByText('–ù–æ–≤—ã–π —É—Ä–æ–∫')).toBeVisible();
  });
});
```

---

## –≠—Ç–∞–ø 11: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### 11.1. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Redis

```typescript
import Redis from 'ioredis';

const redis = new Redis(process.env.REDIS_URL);

export const cacheService = {
  async get<T>(key: string): Promise<T | null> {
    const data = await redis.get(key);
    return data ? JSON.parse(data) : null;
  },

  async set(key: string, value: any, ttl = 3600) {
    await redis.setex(key, ttl, JSON.stringify(value));
  },

  async invalidate(pattern: string) {
    const keys = await redis.keys(pattern);
    if (keys.length > 0) {
      await redis.del(...keys);
    }
  }
};

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
export const lessonsService = {
  async getAll() {
    const cached = await cacheService.get<Lesson[]>('lessons:all');
    if (cached) return cached;

    const lessons = await prisma.lesson.findMany();
    await cacheService.set('lessons:all', lessons, 600); // 10 –º–∏–Ω—É—Ç
    
    return lessons;
  }
};
```

### 11.2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

```bash
npm install sharp
```

```typescript
import sharp from 'sharp';

export const imageService = {
  async optimize(buffer: Buffer): Promise<Buffer> {
    return await sharp(buffer)
      .resize(1920, 1080, { fit: 'inside', withoutEnlargement: true })
      .webp({ quality: 80 })
      .toBuffer();
  }
};
```

### 11.3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
npm install @sentry/node @sentry/tracing
```

```typescript
import * as Sentry from '@sentry/node';

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  tracesSampleRate: 1.0
});

app.use(Sentry.Handlers.requestHandler());
app.use(Sentry.Handlers.tracingHandler());
// ... routes
app.use(Sentry.Handlers.errorHandler());
```

---

## üìä –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç

### Backend
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Node.js + Express
- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å PostgreSQL
- [ ] –°–æ–∑–¥–∞—Ç—å Prisma —Å—Ö–µ–º—É
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API endpoints
- [ ] –î–æ–±–∞–≤–∏—Ç—å JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤ (S3)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã

### Frontend
- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å API –∫–ª–∏–µ–Ω—Ç
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å React Query
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤
- [ ] –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (loading, error)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å E2E —Ç–µ—Å—Ç—ã

### DevOps
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Docker
- [ ] –°–æ–∑–¥–∞—Ç—å CI/CD pipeline
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx
- [ ] –ü–æ–ª—É—á–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±—ç–∫–∞–ø—ã –ë–î

### Telegram
- [ ] –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ –≤ BotFather
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Mini App
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### Development

```bash
# Backend
cd backend
npm install
npx prisma migrate dev
npm run dev

# Frontend
npm install
npm run dev
```

### Production

```bash
# –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker
docker-compose up -d

# –ò–ª–∏ manual
cd backend
npm run build
npm start

# Frontend
npm run build
# –§–∞–π–ª—ã –≤ dist/ —Ä–∞–∑–¥–∞–≤–∞—Ç—å —á–µ—Ä–µ–∑ Nginx
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Telegram Mini Apps Documentation](https://core.telegram.org/bots/webapps)
- [Prisma Documentation](https://www.prisma.io/docs)
- [React Query Documentation](https://tanstack.com/query/latest)
- [AWS S3 SDK Documentation](https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/)

---

**–ê–≤—Ç–æ—Ä:** –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ "–ö—Ä—É–∂–æ–∫ –°—Ç–∞–Ω–∫–µ–≤–∏—á–∞"  
**–î–∞—Ç–∞:** –û–∫—Ç—è–±—Ä—å 2025  
**–í–µ—Ä—Å–∏—è:** 1.0

